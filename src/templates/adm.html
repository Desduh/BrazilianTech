<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,inital-scarle=1.0">
    <meta http-equiv="X-UA-compatible" content="ie=edge">
    <title>Página do Administrador</title>
    <link rel="stylesheet" href="../static/css/style_adm.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>

<body>
    <section class="abas">
        <header>
            <div class="logout">
                <a href="./logout"><img src="..\static\Imagens\logout.png" alt="Logout"></a>
            </div>
            <nav>
                <div class="perfil">
                    <img class="img"src="https://cdn-icons-png.flaticon.com/512/64/64572.png?w=740&t=st=1649205811~exp=1649206411~hmac=2b5ab8271b0f5e8fad6bbbfaf3aebb98fc508fa02302d598d79b31bb4239cf53">
                    <div class="texto">
                       Administrador
                    </div>
                </div>
                <hr>
                <a href="#soli" class="solicitacao">
                    <img class="icone" src="https://cdn-icons-png.flaticon.com/512/37/37770.png?w=360">
                    <div>
                        Nova solicitação
                    </div>
                </a>
                <a href="#graficos" class="solicitacao">
                    <div>
                        Graficos
                    </div>
                </a>
                <a href="#usuarios" class="solicitacao">
                    <div>
                        Usuários
                    </div>
                </a>
                <a href="#historico" class="solicitacao">
                    <div>
                        Minhas solicitações
                    </div>
                </a>
                <h3>Chamados:</h3>
                <a href="#ab" class="solicitacao">
                    <div>
                        Em aberto
                    </div> 
                </a>
                <a href="#ac" class="solicitacao">
                    <div>
                        Aceito
                    </div> 
                </a>
                <a href="#ne" class="solicitacao">
                    <div>
                        Recusado
                    </div> 
                </a>
            </nav>
        </header>
        <main id="soli">
            <div class="tela_solicitacao">
                <form class="tela_solicitacao" name="solicitacao" method="post" action="{{url_for('solicitacao')}}">
                    <label class="texto">Descrição do problema</label>
                    <br>
                    <textarea type ='text' name="solicitacao" class="criacao" placeholder="Descreva a solicitação..." request></textarea>
                    <br>
                    <label class="texto">Tipo de problema</label>
                    <select name="tipo">
                        <option value="Dúvidas ou Esclarecimentos">Dúvidas ou Esclarecimentos</option>
                        <option value="Problemas de Software">Problemas de Software</option>
                        <option value="Problemas de Hardware">Problemas de Hardware</option>
                    </select>
                    <br>
                    <button class="botao" type="submit">Enviar</button>
                </form>
            </div>
        </main>
        <main id="graficos">
            <script type="text/javascript">
              google.charts.load("current", {packages:["corechart"]});
              google.charts.setOnLoadCallback(drawChart);
              function drawChart() {
                var data = google.visualization.arrayToDataTable([
                  ['Status',  'Quantidade'],
                  ['Fechados', {{per_cham[1]}}],
                  ['Abertos', {{per_cham[0]}}],
                ]);
        
                var options ={
                    title: 'Percentual de chamados abertos e fechados',
                    pieHole: 0.4,
                    width: 800,
                    height: 480,
                    colors: ['rgb(177, 10, 4)', 'rgb(15, 76, 129)']
                };
        
                var chart = new google.visualization.PieChart(document.getElementById('donutchart'));
                chart.draw(data, options);
              }
            </script>
               <div id="donutchart" style="width: 100%; height: 100%;"></div>
        </main>
        <main id="usuarios">
            <div>
                <table>
                    <thead>
                        <tr class="text_table">
                            <td>Usuários</td>
                            <td>Função</td>
                            <td>Tornar executor</td>
                        </tr>
                    </thead>
                    {% for user in usuarios %}
                        {% if user[3] == 3 %}
                        {% else %}
                    <tr>
                        <td class="aj">{{user[1]}}</td>
                        {% if user[3] == 1 %}
                        <td class="aj">Usuário</td>
                        {% elif user[3] == 2 %}
                        <td class="aj">Executor</td>
                        {% endif %}
                        {% if user[3] == 1 %}
                        <td class="aj">
                            <form method="POST" action="/tornarexe/{{user.0}}">
                                <button type="submit">Promover</button>
                            </form>
                        </td>
                        {% else %}
                        <td class="aj">
                            <form method="POST" action="/tornaruser/{{user.0}}">
                                <button type="submit">Rebaixar</button>
                            </form>
                        </td>
                        {% endif %}
                    </tr>
                        {% endif %}
                    {% endfor %}
                </table>
            </div>
        </main>
        <main id="historico">
            <table>
                <thead>
                    <tr class="text_table">
                        <td class="aj">Solicitação</td>
                        <td class="aj">Problema</td>
                        <td class="aj">Data da solicitação</td>
                        <td class="aj">Resposta</td>
                        <td class="aj">Data da resposta</td>
                        <td class="aj">Status</td>
                    </tr>
                </thead>
                {% for user in lista %}
                    <tr>
                        <td class="aj">{{user[1]}}</td>
                        <td class="aj">{{user[8]}}</td>
                        <td class="aj">{{user[3]}}</td>
                        <td class="aj">{{user[6]}}</td>
                        <td class="aj">{{user[7]}}</td>
                        <td class="aj">{{user[5]}}</td>
                    </tr>
                {% endfor %}  
            </table>
        </main>
        <main id="ac">
            <table>
                <thead>
                    <tr class="text_table">
                        <td class="aj">Solicitação</td>
                        <td class="aj">Cliente</td>
                        <td class="aj">Data da solicitação</td>
                        <td class="aj">Resposta</td>
                        <td class="aj">Data da resposta</td>
                    </tr>
                </thead>
                {% for user in Details %}
                    {% if user[5] == 'Aceito' %}
                        <tr>
                            <td class="aj">{{user[1]}}</td>
                            <td class="aj">{{user[2]}}</td>
                            <td class="aj">{{user[3]}}</td>
                            <td class="aj">{{user[6]}}</td>
                            <td class="aj">{{user[7]}}</td>
                        </tr>
                    {% endif %}
                {% endfor %}  
            </table>
        </main>
        <main id="ne">
            <table>
                <thead>
                    <tr class="text_table">
                        <td class="aj">Solicitação</td>
                        <td class="aj">Cliente</td>
                        <td class="aj">Data da solicitação</td>
                        <td class="aj">Resposta</td>
                        <td class="aj">Data da resposta</td>
                    </tr>
                </thead>
                {% for user in Details %}
                    {% if user[5] == 'Negado' %}
                        <tr>
                            <td class="aj">{{user[1]}}</td>
                            <td class="aj">{{user[2]}}</td>
                            <td class="aj">{{user[3]}}</td>
                            <td class="aj">{{user[6]}}</td>
                            <td class="aj">{{user[7]}}</td>
                        </tr>
                    {% endif %}
                {% endfor %}  
            </table>
        </main>
        <main id="ab">
            {% for user in Details %}
            {% if user[5] == 'Aberto' %}
            <details>
                <summary>
                    <table>
                        <thead>
                            <tr class="text_table">
                                <td>Usuário: {{user[2]}}</td>
                                <td>Data da solicitação: {{user[3]}}</td>
                            </tr>
                        </thead>
                    </table>
                </summary>
                <table>
                    <thead>
                        <tr>
                            <td>Tipo de problema:</td>
                            <td>Descrição:</td>
                            <td>Resposta:</td>
                        </tr>
                    </thead>
                    <tr>
                        <td><p class="td">{{user[8]}}</p></td>
                        <td><p class="td">{{user[1]}}</p></td>
                        <td>
                            <form class="formulario" method="POST" action="/resposta/{{user.0}}">
                                <textarea type='text' name="resposta" class='Boxtext_motivo' placeholder="Motivo..."request></textarea>
                                <br>
                                <select name="status">
                                    <option value="Aceito">Aceitar chamado</option>
                                    <option value="Negado">Negar chamado</option>
                                </select>
                                <div class="btn">
                                    <button class='btn_' type="submit">Enviar</button>
                            </form>
                            </div>

                            </div>
                        </td>
                    </tr>
                </table>
            </details>
            {% endif %}
            {% endfor %}
        </main>
    </section>
</body>

</html>